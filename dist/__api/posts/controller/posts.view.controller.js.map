{"version":3,"file":"posts.view.controller.js","sourceRoot":"","sources":["../../../../src/__api/posts/controller/posts.view.controller.ts"],"names":[],"mappings":";;AAIA,MAAqB,mBAAmB;IACrB,aAAa,CAAe;IAC7C,YAAY,aAA2B;QACrC,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;QAEnC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACjD,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACnD,CAAC;IAED,iBAAiB;IACjB,KAAK,CAAC,YAAY,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB;QAChE,MAAM,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC7C,MAAM,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAE3C,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC;YAC9C,MAAM;YACN,KAAK;SACN,CAAC,CAAC;QAEH,GAAG,CAAC,MAAM,CAAC,uBAAuB,EAAE;YAClC,KAAK,EAAE,KAAK,CAAC,OAAO;YACpB,KAAK,EAAE,KAAK,CAAC,UAAU;YACvB,IAAI,EAAE,KAAK,CAAC,IAAI;YAChB,IAAI,EAAE,KAAK,CAAC,IAAI;YAChB,KAAK;YACL,MAAM;SACP,CAAC,CAAC;IACL,CAAC;IAED,iBAAiB;IACjB,KAAK,CAAC,cAAc,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB;QAClE,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAEvE,MAAM,QAAQ,GAAG,IAAI,EAAE,MAAM,CAAC,EAAE,CAAC;QAEjC,GAAG,CAAC,MAAM,CAAC,yBAAyB,EAAE;YACpC,IAAI;YACJ,IAAI,EAAE,QAAQ,KAAK,GAAG,CAAC,IAAI,CAAC,MAAM;SACnC,CAAC,CAAC;IACL,CAAC;IAED,iBAAiB;IACjB,KAAK,CAAC,aAAa,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB;QACjE,GAAG,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAC;IACvC,CAAC;IAED,iBAAiB;IACjB,KAAK,CAAC,YAAY,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB;QAChE,MAAM,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;QAE9B,MAAM,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC;QAE/B,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAE5D,MAAM,IAAI,GAAG,MAAM,KAAK,IAAI,EAAE,MAAM,CAAC,EAAE,CAAC;QAExC,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,GAAG,CAAC,IAAI,CAAC;sDACuC,MAAM;kBAC1C,CAAC,CAAC;QAChB,CAAC;QAED,GAAG,CAAC,MAAM,CAAC,uBAAuB,EAAE,EAAE,IAAI,EAAE,CAAC,CAAC;IAChD,CAAC;CACF;AAlED,sCAkEC","sourcesContent":["import { NextFunction, Request, Response } from \"express\";\nimport { PostsService } from \"@/api/posts/service/posts.service.type\";\nimport { JwtService } from \"@/api/common/services/jwt.service\";\n\nexport default class PostsViewController {\n  private readonly _postsService: PostsService;\n  constructor(_postsService: PostsService) {\n    this._postsService = _postsService;\n\n    this.postListPage = this.postListPage.bind(this);\n    this.postDetailPage = this.postDetailPage.bind(this);\n    this.postWritePage = this.postWritePage.bind(this);\n    this.postEditPage = this.postEditPage.bind(this);\n  }\n\n  /** 게시글 목록 페이지 */\n  async postListPage(req: Request, res: Response, next: NextFunction) {\n    const offset = Number(req.query.offset) || 0;\n    const limit = Number(req.query.limit) || 5;\n\n    const posts = await this._postsService.getPosts({\n      offset,\n      limit,\n    });\n\n    res.render(\"client/posts/postList\", {\n      posts: posts.results,\n      count: posts.totalCount,\n      prev: posts.prev,\n      next: posts.next,\n      limit,\n      offset,\n    });\n  }\n\n  /** 게시글 상세 페이지 */\n  async postDetailPage(req: Request, res: Response, next: NextFunction) {\n    const post = await this._postsService.getPostDetail(req.params.postId);\n\n    const authorId = post?.author.id;\n\n    res.render(\"client/posts/postDetail\", {\n      post,\n      isMe: authorId === req.user.userId,\n    });\n  }\n\n  /** 게시글 작성 페이지 */\n  async postWritePage(req: Request, res: Response, next: NextFunction) {\n    res.render(\"client/posts/postWrite\");\n  }\n\n  /** 게시글 수정 페이지 */\n  async postEditPage(req: Request, res: Response, next: NextFunction) {\n    const { postId } = req.params;\n\n    const userId = req.user.userId;\n\n    const post = await this._postsService.getPostDetail(postId);\n\n    const isMe = userId === post?.author.id;\n\n    if (!isMe) {\n      res.send(`<script>\n          alert(\"권한이 없습니다.\"); location.href=\"/posts/${postId}\";\n        </script>`);\n    }\n\n    res.render(\"client/posts/postEdit\", { post });\n  }\n}\n"]}