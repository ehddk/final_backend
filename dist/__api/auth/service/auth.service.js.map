{"version":3,"file":"auth.service.js","sourceRoot":"","sources":["../../../../src/__api/auth/service/auth.service.ts"],"names":[],"mappings":";;;;;;AAAA,yEAAqE;AAMrE,4FAAmE;AACnE,mEAA+D;AAE/D,MAAa,eAAe;IACT,eAAe,CAAiB;IACjD,YAAY,cAA8B;QACxC,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;IACxC,CAAC;IACD,KAAK,CAAC,UAAU,CACd,KAAa,EACb,QAAgB;QAEhB,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAE/D,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,MAAM,IAAI,wBAAa,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;QACjD,CAAC;QAED,MAAM,cAAc,GAAG,8BAAa,CAAC,aAAa,CAChD,QAAQ,EACR,QAAQ,EAAE,QAAQ,IAAI,EAAE,EACxB,QAAQ,CAAC,IAAI,IAAI,EAAE,CACpB,CAAC;QAEF,IAAI,CAAC,cAAc,EAAE,CAAC;YACpB,MAAM,IAAI,wBAAa,CAAC,GAAG,EAAE,kBAAkB,CAAC,CAAC;QACnD,CAAC;QAED,IAAI,QAAQ,CAAC,IAAI,KAAK,OAAO,EAAE,CAAC;YAC9B,MAAM,IAAI,wBAAa,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC;QAC7C,CAAC;QAED,MAAM,WAAW,GAAG,wBAAU,CAAC,mBAAmB,CAAC;YACjD,IAAI,EAAE,QAAQ,CAAC,IAAI;YACnB,MAAM,EAAE,QAAQ,CAAC,EAAE;YACnB,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,OAAO;YACL,WAAW;SACZ,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,KAAK,CAAC,KAAa,EAAE,QAAgB;QACzC,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAE/D,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,MAAM,IAAI,wBAAa,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;QACjD,CAAC;QAED,MAAM,cAAc,GAAG,8BAAa,CAAC,aAAa,CAChD,QAAQ,EACR,QAAQ,EAAE,QAAQ,IAAI,EAAE,EACxB,QAAQ,CAAC,IAAI,IAAI,EAAE,CACpB,CAAC;QAEF,IAAI,CAAC,cAAc,EAAE,CAAC;YACpB,MAAM,IAAI,wBAAa,CAAC,GAAG,EAAE,kBAAkB,CAAC,CAAC;QACnD,CAAC;QAED,MAAM,WAAW,GAAG,wBAAU,CAAC,mBAAmB,CAAC;YACjD,IAAI,EAAE,QAAQ,CAAC,IAAI;YACnB,MAAM,EAAE,QAAQ,CAAC,EAAE;YACnB,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,OAAO;YACL,WAAW;SACZ,CAAC;IACJ,CAAC;CACF;AAnED,0CAmEC","sourcesContent":["import { CryptoService } from \"@/api/common/services/crypto.service\";\nimport {\n  AuthService,\n  LoginResponseType,\n} from \"@/api/auth/service/auth.service.type\";\nimport { UserRepository } from \"@/api/users/repository/user/user.repository\";\nimport HttpException from \"@/api/common/exceptions/http.exception\";\nimport { JwtService } from \"@/api/common/services/jwt.service\";\n\nexport class AuthServiceImpl implements AuthService {\n  private readonly _userRepository: UserRepository;\n  constructor(userRepository: UserRepository) {\n    this._userRepository = userRepository;\n  }\n  async adminLogin(\n    email: string,\n    password: string\n  ): Promise<LoginResponseType> {\n    const findUser = await this._userRepository.findByEmail(email);\n\n    if (!findUser) {\n      throw new HttpException(404, \"존재하지 않는 회원입니다.\");\n    }\n\n    const isSamePassword = CryptoService.matchPassword(\n      password,\n      findUser?.password || \"\",\n      findUser.salt ?? \"\"\n    );\n\n    if (!isSamePassword) {\n      throw new HttpException(401, \"비밀번호가 일치하지 않습니다.\");\n    }\n\n    if (findUser.role !== \"admin\") {\n      throw new HttpException(403, \"관리자가 아닙니다.\");\n    }\n\n    const accessToken = JwtService.generateAccessToken({\n      role: findUser.role,\n      userId: findUser.id,\n      expiresIn: \"7d\",\n    });\n\n    return {\n      accessToken,\n    };\n  }\n\n  async login(email: string, password: string): Promise<LoginResponseType> {\n    const findUser = await this._userRepository.findByEmail(email);\n\n    if (!findUser) {\n      throw new HttpException(404, \"존재하지 않는 회원입니다.\");\n    }\n\n    const isSamePassword = CryptoService.matchPassword(\n      password,\n      findUser?.password || \"\",\n      findUser.salt ?? \"\"\n    );\n\n    if (!isSamePassword) {\n      throw new HttpException(401, \"비밀번호가 일치하지 않습니다.\");\n    }\n\n    const accessToken = JwtService.generateAccessToken({\n      role: findUser.role,\n      userId: findUser.id,\n      expiresIn: \"7d\",\n    });\n\n    return {\n      accessToken,\n    };\n  }\n}\n"]}